#!/bin/sh

# VÃ©rification des tests avant le push
echo "ğŸ§ª ExÃ©cution des tests..."

# Tests Vue (si disponibles)
if [ -f "package.json" ]; then
    if grep -q "\"test\"" package.json; then
        npm test
        if [ $? -ne 0 ]; then
            echo "âŒ Les tests ont Ã©chouÃ©"
            exit 1
        fi
        echo "âœ… Tests : OK"
    fi
fi

# VÃ©rification des branches protÃ©gÃ©es
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')
protected_branches="^(main|master|develop)$"

if [[ "$current_branch" =~ $protected_branches ]]; then
    echo "âŒ Push direct sur la branche $current_branch non autorisÃ©"
    echo "ğŸ“ CrÃ©ez une branche feature/* et une Pull Request"
    exit 1
fi

echo "âœ… Pre-push hooks passÃ©s avec succÃ¨s !"
exit 0
